<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="">
<!--<![endif]-->

<head>
    <% include partials/head %>
    <title>Danone</title>
    <style>
        html,body{
            overflow-x: hidden;
        }
        .new-user-card{
            position: absolute;
            right: -275px;
            bottom: 25px;
            width: 250px;
            transition: all 0.3s;
            border: 1px solid #002677;
            color: #ffffff;
        }
        .new-user-card .card-header{
            background-color: #002677;
        }
        .move{
        right: 15px;
        }
    </style>
</head>
<body>
    <!-- Left Panel -->
    <% include partials/leftPanel %>
        <!-- /#left-panel -->
        <!-- Right Panel -->
        <div id="right-panel" class="right-panel">
            <!-- Header-->
            <header id="header" class="header">
                <div class="header-menu">
                    <div class="col-sm-7">
                        <a id="menuToggle" class="menutoggle pull-left">
                            <i class="fa fa fa-tasks"></i>
                        </a>
                    </div>
                    <div class="col-sm-5">
                        <div class="user-area float-right">
                            <a href="#" aria-expanded="false">
                                <i class="fa fa-power-off"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </header>
            <div class="content mt-3">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header">
                                <strong class="card-title">
                                        Facebook
                                </strong>
                            </div>
                            <div class="card-body">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th scope="col">Name</th>
                                            <th scope="col">Chat started</th>
                                            <th scope="col">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% for(var i=0; i<docs.length;i++) { %>
                                            <tr>
                                                <td>
                                                    <%= docs[i].userName %>
                                                </td>
                                                <td>
                                                    <%= moment(docs[i].started_at).fromNow(); %>
                                                </td>
                                                <td>
                                                    <a class="btn btn-danger" href="/user/chat/<%= docs[i].fbid %>">Chat</a>
                                                </td>
                                            </tr>
                                            <% } %>
                                    </tbody>
                                </table>
                                <!-- <ul class="pagination">
                                    <li class="page-item">
                                        <% 
                                    var pre = 1;
                                    if(page != undefined && !isNaN(page)){
                                        pre = page;
                                    }
                                    if(pre<1)
                                    {
                                        pre=1;
                                    }
                                    else if(pre >= pages){
                                        if(pages>1)
                                            pre = pages-1;
                                        else
                                         pre = 1;
                                    }
                                    var next = pre+2;
                                    if(next>pages){
                                        next = pages;
                                    }
                                    %>
                                            <a class="page-link" href="/user/<%= pre %>">
                                                <span aria-hidden="true">&laquo;</span>
                                                <span class="sr-only">Previous</span>
                                            </a>
                                    </li>
                                    <% for(var i=1; i<=pages; i++){ %>
                                        <li class="page-item <% if(page==i){ %>active<% } %>">
                                            <a class="page-link" href="/user/<%= i %>">
                                                <%= i %>
                                            </a>
                                        </li>
                                    <% } %>
                                    <li class="page-item">
                                        <a class="page-link" href="/user/<%= next %>">
                                            <span aria-hidden="true">&raquo;</span>
                                            <span class="sr-only">Next</span>
                                        </a>
                                    </li>
                                </ul> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card new-user-card" id="new-user-card">
                <div class="card-header">
                    <strong class="card-title text-light">New Request</strong>
                </div>
                <div class="card-body text-white">
                    <p class="card-text">There is new request from user. Do you want to refresh the page?</p>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <a href="#" id="refresh"> <i class="fa fa-refresh"></i> Yes</a>
                        </li>
                        <li class="list-group-item">
                            <a href="#" id="noRefresh"> <i class="fa fa-times"></i> No</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- /#right-panel -->
        <!-- Right Panel -->
        <% include partials/scripts %>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
        <script>
            var socket = io.connect('https://danone-apta-advice.herokuapp.com');
            $(function(){
                socket.on('new-message-WbINSag0HY', function (data) {
                    if (data.msgType == "new thread") {
                        if(!$('.new-user-card').hasClass('move')){
                            $('.new-user-card').addClass('move');
                        }
                    }
                });
                $("#noRefresh").click(function(){
                    $('.new-user-card').removeClass('move');
                });
                $("#refresh").click(function(){
                        $('.new-user-card').removeClass('move');
                        var url = "/user/";
                        window.location = url;
                });
            });
        </script>
</body>
</html>